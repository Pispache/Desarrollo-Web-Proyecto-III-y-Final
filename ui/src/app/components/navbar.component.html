<!-- 
/// <summary>
  /// Barra de navegación principal del sistema de marcador de baloncesto.
  /// </summary>
  /// - Muestra el logo y el nombre de la aplicación.
  /// - Ofrece enlaces a secciones clave:
  ///    • CONTROL visible solo para usuarios autenticados.
  ///    • EQUIPOS visible únicamente para administradores.
  /// - Resalta la opción activa según la ruta actual.
  /// - Permite cerrar el menú al hacer clic en enlaces (útil en dispositivos móviles).
  /// - Adaptable a desktop y mobile (esta sección corresponde al menú de escritorio).
  -->

<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo -->
    <div class="navbar-brand">
      <span class="brand-link">
        <i class="bi bi-trophy-fill"></i>
        <span class="brand-text">Marcador BB</span>
      </span>
    </div>

    <!-- Desktop Menu -->
    <div class="navbar-menu desktop-menu">
      <ul class="navbar-nav">
        <li class="nav-item" *ngIf="isAuthenticated">
          <a routerLink="/control" 
             class="nav-link" 
             [class.active]="isActiveRoute('/control')"
             (click)="closeMenu()">
            <i class="bi bi-house-fill"></i>
            <span>CONTROL</span>
          </a>
        </li>
        
        <!-- Grupo de administración compactado -->
        <li class="nav-item admin-dropdown" *ngIf="isAdmin" [class.open]="adminOpen">
          <button class="nav-link dropdown-toggle" type="button" (click)="toggleAdminMenu($event)">
            <i class="bi bi-gear-fill"></i>
            <span>ADMINISTRACIÓN</span>
          </button>
          <ul class="dropdown-menu">
            <li>
              <a routerLink="/equipos" class="dropdown-item" [class.active]="isActiveRoute('/equipos')" (click)="closeMenu()">
                <i class="bi bi-people-fill"></i>
                <span>Equipos</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" (click)="navigateToPlayers()" [class.active]="isActiveRoute('/jugadores')">
                <i class="bi bi-people"></i>
                <span>Jugadores</span>
              </a>
            </li>
            <li>
              <a routerLink="/reportes" class="dropdown-item" [class.active]="isActiveRoute('/reportes')" (click)="closeMenu()">
                <i class="bi bi-file-earmark-pdf-fill"></i>
                <span>Reportes</span>
              </a>
            </li>
            <li>
              <a routerLink="/administracion/usuarios" class="dropdown-item" [class.active]="isActiveRoute('/administracion/usuarios')" (click)="closeMenu()">
                <i class="bi bi-people"></i>
                <span>Usuarios</span>
              </a>
            </li>
          </ul>
        </li>
        
        <li class="nav-item">
          <a routerLink="/tableros" 
             class="nav-link" 
             [class.active]="isActiveRoute('/tableros')"
             (click)="closeMenu()">
            <i class="bi bi-display"></i>
            <span>TABLEROS</span>
          </a>
        </li>
        
        <li class="nav-item">
          <a routerLink="/resultados" 
             class="nav-link" 
             [class.active]="isActiveRoute('/resultados')"
             (click)="closeMenu()">
            <i class="bi bi-bar-chart-fill"></i>
            <span>RESULTADOS</span>
          </a>
        </li>


        <li class="nav-item">
          <a routerLink="/torneo" 
             class="nav-link" 
             [class.active]="isActiveRoute('/torneo')"
             (click)="closeMenu()">
            <span>TORNEO</span>
          </a>
        </li>
        
        <li class="nav-item" *ngIf="!isAuthenticated">
          <a routerLink="/login" 
             class="nav-link" 
             [class.active]="isActiveRoute('/login')"
             (click)="closeMenu()">
            <i class="bi bi-box-arrow-in-right"></i>
            <span>LOGIN</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Desktop Actions: derecha -->
    <div class="nav-actions d-none d-md-flex align-items-center gap-2">
      <button class="btn btn-sm btn-refresh" (click)="onRefresh()" title="Actualizar datos">
        <i class="bi bi-arrow-clockwise me-1"></i>
        <span>Actualizar</span>
      </button>
      <div class="theme-pill">
        <app-theme-toggle size="sm"></app-theme-toggle>
      </div>
      <button *ngIf="isAuthenticated" class="btn btn-sm btn-logout" (click)="logout()" title="Cerrar sesión">
        <i class="bi bi-box-arrow-right me-1"></i>
        <span>Cerrar sesión</span>
      </button>
      <!-- Indicador de usuario al extremo derecho (icono + nombre + rol) -->
      <!-- Perfil (chip de usuario)
           - Muestra avatar del proveedor OAuth (si existe) o ícono genérico.
           - Incluye insignia del proveedor: GitHub/Google/Facebook. -->
      <a *ngIf="isAuthenticated" routerLink="/perfil" class="d-flex align-items-center ms-auto px-2 py-1 text-light user-chip text-decoration-none">
        <span class="avatar-wrap me-2 position-relative d-inline-flex align-items-center justify-content-center">
          <ng-container *ngIf="avatarUrl; else iconFallback">
            <img
              [src]="avatarUrl"
              alt="Avatar de usuario"
              class="avatar-img"
              referrerpolicy="no-referrer"
              loading="lazy" />
          </ng-container>
          <ng-template #iconFallback>
            <i class="bi bi-person-circle"></i>
          </ng-template>
          <!-- Insignia del proveedor OAuth -->
          <span *ngIf="oauthProvider" class="provider-badge" [attr.data-provider]="oauthProvider" aria-hidden="true">
            <i class="bi" [ngClass]="{
              'bi-github': oauthProvider==='github',
              'bi-google': oauthProvider==='google',
              'bi-facebook': oauthProvider==='facebook'
            }"></i>
          </span>
        </span>
        <span class="fw-semibold">
          {{ username || 'Usuario' }}
          <small class="ms-2 text-muted" *ngIf="role">({{ role | uppercase }})</small>
        </span>
      </a>
    </div>

    <!-- Mobile Menu Toggle (Bootstrap Icons for consistency) -->
    <button
      class="navbar-toggler mobile-menu-toggle"
      type="button"
      aria-label="Toggle navigation"
      [attr.aria-expanded]="isMenuOpen"
      (click)="toggleMenu()">
      <i class="hamburger-icon" [ngClass]="isMenuOpen ? 'bi bi-x-lg' : 'bi bi-list'"></i>
    </button>
  </div>

  <div class="mobile-menu-overlay" 
       [class.active]="isMenuOpen" 
       (click)="closeMenu()">
  </div>

  <!-- Mobile Menu as Bootstrap Dropdown -->
  <div class="mobile-menu dropdown-menu" [class.show]="isMenuOpen">
    <!-- Mobile quick actions -->
    <div class="mobile-quick-actions px-3 py-2 d-flex align-items-center gap-2 border-bottom">
      <button class="btn btn-primary btn-sm w-100" (click)="onRefresh(); closeMenu()">
        <i class="bi bi-arrow-clockwise me-1"></i> Actualizar
      </button>
      <app-theme-toggle size="sm"></app-theme-toggle>
      <!-- Nota: En modo hamburguesa movemos usuario y 'Cerrar sesión' a la sección Cuenta (abajo) para evitar duplicados -->
    </div>
    
    <ul class="mobile-nav">
      <li class="dropdown-header px-3 text-uppercase small text-muted">Navegación</li>
      <li *ngIf="isAuthenticated">
        <a class="dropdown-item" routerLink="/control" 
           [class.active]="isActiveRoute('/control')"
           (click)="closeMenu()">
          <i class="bi bi-house-fill"></i>
          <span>Panel de Control</span>
        </a>
      </li>
      
      <!-- Administración (colapsable en móvil) -->
      <li *ngIf="isAdmin" class="mobile-admin" [class.open]="adminOpen">
        <button class="dropdown-item d-flex align-items-center justify-content-between" (click)="toggleAdminMenu($event)">
          <span class="d-inline-flex align-items-center gap-2">
            <i class="bi bi-gear-fill"></i>
            <span>Administración</span>
          </span>
          <i class="bi" [ngClass]="adminOpen ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
        </button>
        <ul class="submenu" *ngIf="adminOpen">
          <li>
            <a class="dropdown-item" routerLink="/equipos" [class.active]="isActiveRoute('/equipos')" (click)="closeMenu()">
              <i class="bi bi-people-fill"></i>
              <span>Equipos</span>
            </a>
          </li>
          <li>
            <a class="dropdown-item" (click)="navigateToPlayers()" [class.active]="isActiveRoute('/jugadores')">
              <i class="bi bi-people"></i>
              <span>Jugadores</span>
            </a>
          </li>
          <li>
            <a class="dropdown-item" routerLink="/reportes" [class.active]="isActiveRoute('/reportes')" (click)="closeMenu()">
              <i class="bi bi-file-earmark-pdf-fill"></i>
              <span>Reportes</span>
            </a>
          </li>
          <li>
            <a class="dropdown-item" routerLink="/administracion/usuarios" [class.active]="isActiveRoute('/administracion/usuarios')" (click)="closeMenu()">
              <i class="bi bi-people"></i>
              <span>Usuarios</span>
            </a>
          </li>
        </ul>
      </li>
      
      <li>
        <a class="dropdown-item" routerLink="/tableros" 
           [class.active]="isActiveRoute('/tableros')"
           (click)="closeMenu()">
          <i class="bi bi-display"></i>
          <span>Tableros</span>
        </a>
      </li>
      
      <li>
        <a class="dropdown-item" routerLink="/resultados" 
           [class.active]="isActiveRoute('/resultados')"
           (click)="closeMenu()">
          <i class="bi bi-bar-chart-fill"></i>
          <span>Resultados</span>
        </a>
      </li>
      
      
      <li>
        <a class="dropdown-item" routerLink="/torneo" 
           [class.active]="isActiveRoute('/torneo')"
           (click)="closeMenu()">
          <i class="bi bi-bar-chart-fill"></i>
          <span>Torneo</span>
        </a>
      </li>

      <!-- (Opcional) puedes mantener 'Perfil' fuera del grupo si quieres -->

      <li><hr class="dropdown-divider"></li>
      <li class="dropdown-header px-3 text-uppercase small text-muted">Cuenta</li>

      <!-- Usuario autenticado: avatar + nombre con enlace a Perfil -->
      <li *ngIf="isAuthenticated">
        <a routerLink="/perfil" class="dropdown-item d-flex align-items-center gap-2">
          <span class="avatar-wrap position-relative d-inline-flex align-items-center justify-content-center">
            <ng-container *ngIf="avatarUrl; else mobileIconFallback">
              <img [src]="avatarUrl" alt="Avatar" class="avatar-img" referrerpolicy="no-referrer" loading="lazy" width="28" height="28" />
            </ng-container>
            <ng-template #mobileIconFallback>
              <i class="bi bi-person-circle"></i>
            </ng-template>
            <span *ngIf="oauthProvider" class="provider-badge" [attr.data-provider]="oauthProvider" aria-hidden="true">
              <i class="bi" [ngClass]="{
                'bi-github': oauthProvider==='github',
                'bi-google': oauthProvider==='google',
                'bi-facebook': oauthProvider==='facebook'
              }"></i>
            </span>
          </span>
          <span class="small">{{ username || 'Usuario' }}</span>
        </a>
      </li>
      <li *ngIf="isAuthenticated">
        <a class="dropdown-item text-danger" (click)="logout()">
          <i class="bi bi-box-arrow-right"></i>
          <span>Cerrar sesión</span>
        </a>
      </li>

      <!-- Usuario no autenticado: opción de iniciar sesión -->
      <li *ngIf="!isAuthenticated">
        <a class="dropdown-item" routerLink="/login" 
           (click)="closeMenu()">
          <i class="bi bi-box-arrow-in-right"></i>
          <span>Iniciar Sesión</span>
        </a>
      </li>
    </ul>
  </div>
</nav>
