<!--
/// <summary>
/// Vista pública del marcador (display) para un partido.
/// </summary>
/// <remarks>
/// - Muestra equipos, tanteador, cuarto y reloj en estilo LED.
/// - Indica estado del juego y BONUS por faltas.
/// - Incluye panel de control visible solo para administradores.
/// </remarks>
-->
     <br>
<div class="container-fluid min-vh-100 p-0">
  <!-- Encabezado del marcador -->
  <header class="glass-header">
    <div class="page-wrap">
      <div class="row align-items-center">
        <div class="col-12 d-flex justify-content-between align-items-center">
          <br>  
          <button
            type="button"
            class="btn btn-outline-secondary btn-sm"
            (click)="goBackToBoards()"
            aria-label="Volver a Tableros"
            title="Volver a Tableros">
            <i class="bi bi-arrow-left"></i>
            <span class="d-none d-sm-inline ms-1">Volver a Tableros</span>
          </button>
          <h1 class="h5 mb-0 glass-title">MARCADOR DE BALONCESTO</h1>
          
          <div *ngIf="detail" class="glass-status mt-1"
               [ngClass]="{
                 'in-progress': detail.game.status === 'IN_PROGRESS',
                 'finished': detail.game.status === 'FINISHED',
                 'cancelled': detail.game.status === 'CANCELLED',
                 'suspended': detail.game.status === 'SUSPENDED',
                 'scheduled': detail.game.status === 'SCHEDULED'
               }">
            {{ 
              detail.game.status === 'IN_PROGRESS' ? 'EN PROGRESO' :
              detail.game.status === 'FINISHED' ? 'FINALIZADO' :
              detail.game.status === 'CANCELLED' ? 'CANCELADO' :
              detail.game.status === 'SUSPENDED' ? 'SUSPENDIDO' :
              'PROGRAMADO'
            }}
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Indicador de carga (LED) -->
  <div *ngIf="!detail" class="d-flex justify-content-center align-items-center vh-100">
    <div class="text-center">
      <div class="led-loader" aria-label="Cargando...">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>
      <p class="mt-3 text-muted">Cargando datos del partido...</p>
    </div>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="detail as d" class="py-3">
    <div class="led-display">
      <!-- Fondo negro para el display LED -->
      <div class="led-container">
        <!-- Encabezado con estado del partido -->
        <div class="led-header">
          <div class="led-league">{{ d.game.leagueName || 'LIGA' }}</div>
          <div class="led-status" 
               [class.led-status-in-progress]="d.game.status === 'IN_PROGRESS'"
               [class.led-status-suspended]="d.game.status === 'SUSPENDED'"
               [class.led-status-finished]="d.game.status === 'FINISHED'">
            {{ getGameStatus(d.game.status) }}
          </div>
        </div>

        <!-- Cuarto y tiempo -->
        <div class="led-period">
          <div class="led-quarter">{{ getQuarterName(d.game.quarter) }}</div>
          <div class="led-time" [class.led-time-warning]="isTimeLow()">{{ formatGameTime() }}</div>
        </div>

        <!-- Equipos y puntuación -->
        <div class="led-teams">
          <!-- Equipo Local -->
          <div class="led-team led-team-home">
            <img *ngIf="homeLogoUrl"
                 [src]="homeLogoUrl"
                 alt="Logo local"
                 class="led-team-logo border border-secondary"
                 loading="eager" decoding="async" fetchpriority="high">
            <div class="led-team-name">{{ d.game.homeTeam }}</div>
            <div class="led-score">{{ d.game.homeScore || 0 }}</div>
            <div class="led-fouls" [class.led-fouls-bonus]="getTeamFouls('home') >= 5">
              FALTAS: {{ getTeamFouls('home') || 0 }}
              <span *ngIf="getTeamFouls('home') >= 5" class="led-bonus">BONUS</span>
            </div>
          </div>
          
          <!-- VS -->
          <div class="led-vs">VS</div>
          
          <!-- Equipo Visitante -->
          <div class="led-team led-team-away">
            <img *ngIf="awayLogoUrl"
                 [src]="awayLogoUrl"
                 alt="Logo visitante"
                 class="led-team-logo border border-secondary"
                 loading="eager" decoding="async" fetchpriority="high">
            <div class="led-team-name">{{ d.game.awayTeam }}</div>
            <div class="led-score">{{ d.game.awayScore || 0 }}</div>
            <div class="led-fouls" [class.led-fouls-bonus]="getTeamFouls('away') >= 5">
              FALTAS: {{ getTeamFouls('away') || 0 }}
              <span *ngIf="getTeamFouls('away') >= 5" class="led-bonus">BONUS</span>
            </div>
          </div>
        </div>

        <!-- Resultado final -->
        <div *ngIf="d.game.status === 'FINISHED'" class="led-verdict">
          <div class="verdict-text">
            {{ getWinner(d.game) }}
          </div>
          <div class="verdict-scores">
            {{ d.game.homeTeam }} {{ d.game.homeScore || 0 }} - {{ d.game.awayScore || 0 }} {{ d.game.awayTeam }}
          </div>
        </div>

        <!-- Pie de página del marcador -->
        <div class="led-footer">
          <div *ngIf="isGameSuspended" class="led-suspended">
            <i class="bi bi-pause-fill"></i> PARTIDO SUSPENDIDO
          </div>
        </div>
      </div>
    </div>
    
    <!-- Panel de control (solo visible para administradores) -->
    <div *ngIf="isAdmin && detail" class="admin-panel">
      <app-control-panel 
        [game]="detail.game"
        (changed)="refreshGame()"
        (resetRequested)="refreshGame()">
      </app-control-panel>
    </div>
  </div>

  <!-- Pie de página del sistema (glass) -->
  <footer class="glass-footer">
    <div class="container">
      <div class="row">
        <div class="col-12 text-center small">
          Sistema de Marcador de Baloncesto
        </div>
      </div>
    </div>
  </footer>
</div>
