# Crontab - ETL Marcador de Baloncesto
# Formato: minuto hora día mes día_semana comando

SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=""

# Sincronización cada 5 minutos
*/5 * * * * cd /app && python3 main.py >> /var/log/etl/cron.log 2>&1

# Verificación diaria (2 AM)
0 2 * * * /app/scripts/verify-etl.sh >> /var/log/etl/verify.log 2>&1

# Limpieza de logs antiguos (domingos 3 AM)
0 3 * * 0 find /var/log/etl -name "*.log" -mtime +30 -delete

# Backup de checkpoints (4 AM)
0 4 * * * PGPASSWORD="$POSTGRES_PASSWORD" psql -h postgres -U postgres -d reportsdb -c "COPY etl_state TO STDOUT" > /var/backups/etl_checkpoints_$(date +\%Y\%m\%d).csv 2>&1
